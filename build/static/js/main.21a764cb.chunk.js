(this["webpackJsonpreact-platformer"]=this["webpackJsonpreact-platformer"]||[]).push([[0],{21:function(t,e,i){},24:function(t,e,i){"use strict";i.r(e);var a=i(6),n=i.n(a),s=i(16),r=i.n(s),h=(i(21),i(4)),o=i(0),l=i(1),c=i(3);function m(t,e){return Math.random()*(e-t)+t}function f(t,e){return Math.floor(m(t,e))}var u=function(){function t(e){Object(o.a)(this,t),this.game=e,this.startX=0,this.startY=0,this.endX=16,this.endY=11,this.mut=[1,1],this.followingObject=null,this.followSpeed=2,this.followX=!0,this.followY=!0,this.minX=null,this.minY=null,this.maxX=null,this.maxY=null,this.shakeTick=0,this.shakeMagnitude=1,this.calculateMultiplier()}return Object(l.a)(t,[{key:"shake",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.shakeTick=t,this.shakeMagnitude=e}},{key:"update",value:function(t){if(this.followingObject){var e=this.followingObject.getCenter(),i=this.getCenter();"number"===typeof this.maxY&&(e[1]=Math.min(this.maxY-this.getHeight()/2,e[1])),"number"===typeof this.minX&&(e[0]=Math.max(this.minX+this.getWidth()/2,e[0]));var a=e[0]-i[0],n=e[1]-i[1];if(Math.abs(a)>.01||Math.abs(n)>.01){var s=function(t){r[t]<e[t]?r[t]+h<e[t]?r[t]+=h:r[t]=e[t]:r[t]>e[t]&&(r[t]-h>e[t]?r[t]-=h:r[t]=e[t])},r=[i[0],i[1]],h=function(t,e,i,a){var n=i-t,s=a-e;return Math.sqrt(s*s+n*n)}(e[0],e[1],i[0],i[1])*t*this.followSpeed;Math.abs(a)>.1&&this.followX&&s(0),Math.abs(n)>.1&&this.followY&&s(1),this.shakeTick>0&&(this.shakeTick-=t,r[0]+=m(-1,1)/100*this.shakeMagnitude,r[1]+=m(-1,1)/100*this.shakeMagnitude),this.setPositionCenter(r[0],r[1])}}}},{key:"updateAspectRatio",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.game.getViewport();if(t){var i=this.getHeight(),a=i*(e[0]/e[1]);this.setPositionCenterAndSize.apply(this,Object(c.a)(this.getCenter()).concat([a,i]))}else{var n=this.getWidth(),s=n*(e[1]/e[0]);this.setPositionCenterAndSize.apply(this,Object(c.a)(this.getCenter()).concat([n,s]))}}},{key:"scaleSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.setPositionCenterAndSize.apply(this,Object(c.a)(this.getCenter()).concat([this.getWidth()*t,this.getHeight()*t]))}},{key:"setPositionCenter",value:function(t,e){this.setPositionCenterAndSize(t,e,this.endX-this.startX,this.endY-this.startY)}},{key:"setPositionCenterAndSize",value:function(t,e,i,a){var n=[i,a];this.startX=t-n[0]/2,this.startY=e-n[1]/2,this.endX=t+n[0]/2,this.endY=e+n[1]/2,this.calculateMultiplier()}},{key:"setSize",value:function(t,e){var i=this.getCenter();this.setPositionCenterAndSize(i[0],i[1],t,e)}},{key:"getCenter",value:function(){return[this.startX+this.getWidth()/2,this.startY+this.getHeight()/2]}},{key:"getWidth",value:function(){return this.endX-this.startX}},{key:"getHeight",value:function(){return this.endY-this.startY}},{key:"calculateMultiplier",value:function(){var t=this.game.getViewport();this.mut=[t[0]/this.getWidth(),t[1]/this.getHeight()]}},{key:"transformX",value:function(t){return t*this.mut[0]}},{key:"transformY",value:function(t){return t*this.mut[1]}},{key:"transformCoordinates",value:function(t,e){var i=[t-this.startX,e-this.startY];return i[0]*=this.mut[0],i[1]*=this.mut[1],i}},{key:"transformRect",value:function(t,e,i,a){return[].concat(Object(c.a)(this.transformCoordinates(t,e)),[this.transformX(i),this.transformY(a)])}}]),t}(),p=function(){function t(e){Object(o.a)(this,t),this.game=e,this.controlling=this.game.player}return Object(l.a)(t,[{key:"update",value:function(t){var e=(this.controlling.onGround?6:5.5)*t;this.game.inputManager.isKeyDown("shift")&&(e/=5),this.controlling.crouch&&(e/=5);var i=this.game.inputManager.isKeyDown("a")||this.game.inputManager.isKeyDown("ArrowLeft"),a=this.game.inputManager.isKeyDown("d")||this.game.inputManager.isKeyDown("ArrowRight"),n=i^a&&!this.controlling.animation.disableController;n?(i&&(this.controlling.x-=e,this.controlling.facing=0),a&&(this.controlling.x+=e,this.controlling.facing=1),this.controlling.running||(this.controlling.running=!0)):this.controlling.running&&(this.controlling.running=!1);var s=!1;if((this.game.inputManager.isKeyDown("s")||this.game.inputManager.isKeyDown("ArrowDown"))&&(this.controlling.ledgeHang?this.controlling.y+=t:this.controlling.onGround&&(n?this.controlling.crouch?s=!0:this.controlling.slide():s="crouch"===this.controlling.animationName||"crawl"===this.controlling.animationName||this.controlling.animation.idle)),this.controlling.setCrouch(s),(this.game.inputManager.isKeyPressed("w")||this.game.inputManager.isKeyPressed(" ")||this.game.inputManager.isKeyPressed("ArrowUp"))&&(this.controlling.animation.disableController||this.controlling.jump()),this.controlling.animation.disableController||(this.game.inputManager.isMousePressed("0")&&(this.controlling.onGround?this.controlling.attack():this.controlling.groundSlam()),this.game.inputManager.isKeyPressed("f")&&this.controlling.knockback(),this.game.inputManager.isKeyPressed("g")&&(this.game.showInfo=!this.game.showInfo)),this.game.inputManager.isKeyPressed("-")&&this.game.camera.scaleSize(1.1),this.game.inputManager.isKeyPressed("=")&&this.game.camera.scaleSize(.9),this.controlling.x>this.game.levelWidth/5){for(var r=this.game.map,o=[],l=0;l<r.length;l++){var m=this.game.convertIndexToCoordinates(l),f=Object(h.a)(m,2),u=(f[0],f[1]);(o[u]||(o[u]=[])).push(r[l])}var p=[];for(l=0;l<o.length;l++)p.push.apply(p,Object(c.a)(o[l]).concat(Object(c.a)(o[l])));this.game.map=p,this.game.levelWidth*=2,this.game.collisionMap=this.game.createCollisionMap()}}}]),t}(),d=i(13),g=i(7),y=i(14),v=i(12),w=function(){function t(e){Object(o.a)(this,t),this.game=e,this.x=0,this.y=0,this.w=0,this.h=0,this.velocityX=0,this.velocityY=0,this.colliding=!1,this.delete=!1}return Object(l.a)(t,[{key:"setVelocity",value:function(t,e){this.velocityX=t,this.velocityY=e}},{key:"setLeft",value:function(t){this.x=t}},{key:"getLeft",value:function(){return this.x}},{key:"setRight",value:function(t){this.x=t-this.w}},{key:"getRight",value:function(){return this.x+this.w}},{key:"setTop",value:function(t){this.y=t}},{key:"getTop",value:function(){return this.y}},{key:"setBottom",value:function(t){this.y=t-this.h}},{key:"getBottom",value:function(){return this.y+this.h}},{key:"getCenter",value:function(){return[this.x+this.w/2,this.y+this.h/2]}},{key:"update",value:function(t){if(this.velocityX){var e=this.velocityX<0,i=Math.abs(this.velocityX);(n=Math.max(4*i*t,t/2))>i&&(n=i),(i-=n)<0&&(i=0),this.velocityX=e?-i:i;var a=e?-n:n;this.x+=a}if(this.velocityY){var n;e=this.velocityY<0,i=Math.abs(this.velocityY);(n=Math.max(4*i*t,t/2))>i&&(n=i),(i-=n)<0&&(i=0),this.velocityY=e?-i:i;a=e?-n:n;this.y+=a}this.tiles={},this.onGround=!1,this.colliding=!1;for(var s=new Set,r=Math.floor(this.x)-1;r<=Math.floor(this.x+this.w)+1;r+=.4)for(var o=Math.floor(this.y)-1;o<=Math.floor(this.y+this.h)+1;o+=.4){var l=Math.floor(r),c=Math.floor(o),m=this.game.convertCoordinatesToIndex(l,c);this.game.collisionMap[m]&&s.add(m)}for(var f=null,u=0,p=0,d=null,g=!1,y=0,v=Array.from(s);y<v.length;y++){var w=v[y],_=this.game.convertIndexToCoordinates(w),x=Object(h.a)(_,2),k={x:r=x[0],y:o=x[1],w:1,h:1};if(this.collidesWith(k)){var b=this.calculateOverlap(k);"top"===b&&(this.crouch||"top"===this.calculateOverlap(k,{x:this.x,y:this.getBottom()-.1,w:this.w,h:.1})||(b=this.x<k.x?"left":"right"));var j={left:1,right:2,top:4,bottom:8}[b];this.game.collisionMap[w]&j&&(this.colliding=!0,"top"===b?(this.onGround=!0,p=o,this.getBottom()>o&&this.setBottom(o+.01)):"bottom"===b?this.getTop()<o+1&&this.setTop(o+1):"left"===b?(f=r-this.w,u=o,d=k,g=1===this.facing):"right"===b&&(f=r+k.w,u=o,d=k,g=0===this.facing),this.tiles[w]=j)}}"number"===typeof f&&p!==u?(this.x=f,!this.onGround&&"crawl"!==this.animationName&&"roll"!==this.animationName&&g&&this.game.collisionMap[this.game.convertCoordinatesToIndex(d.x,d.y-1)]&&(this.y-Math.floor(this.y)<.3||this.game.collisionMap[this.game.convertCoordinatesToIndex(d.x,d.y+1)])&&(this.ledgeHang=!0,"ledge_hang"!==this.animationName&&"wall_jump"!==this.animationName&&this.setAnimation("ledge_hang"))):this.ledgeHang&&(this.ledgeHang=!1,this.setAnimation("fall"))}},{key:"collidesWith",value:function(t,e){var i=e||this,a=t;return i.x<a.x+a.w&&i.x+i.w>a.x&&i.y<a.y+a.h&&i.h+i.y>a.y}},{key:"calculateOverlap",value:function(t,e){var i=e||this,a=t,n=i.x+i.w/2-(a.x+a.w/2),s=i.y+i.h/2-(a.y+a.h/2),r=(i.w+a.w)/2,h=(i.h+a.h)/2,o=r*s,l=h*n,c="none";return Math.abs(n)<=r&&Math.abs(s)<=h&&(c=o>l?o>-l?"bottom":"left":o>-l?"right":"top"),c}}]),t}(),_=function(t){Object(y.a)(i,t);var e=Object(v.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).w=.1,a.h=.1,a.direction=-1,a}return Object(l.a)(i,[{key:"render",value:function(){this.game.render.drawRect(this.x,this.y,this.w,this.h,"#ff2222")}},{key:"update",value:function(t){this.x+=t*this.direction*3,Object(d.a)(Object(g.a)(i.prototype),"update",this).call(this),this.collidesWith(this.game.player)&&("attack1"===this.game.player.animationName?(this.direction=0===this.game.player.facing?-1:1,this.game.particleSystem.spawnParticles(this.x,this.y,6,.5),this.game.camera.shake()):"ground_slam"===this.game.player.animationName?(this.colliding=!0,this.game.camera.shake()):(this.game.player.facing=this.direction<0?1:0,this.game.player.knockback(),this.colliding=!0)),this.colliding&&(this.delete=!0,this.game.particleSystem.spawnParticles(this.x,this.y,5,.3))}}]),i}(w),x=function(){function t(){Object(o.a)(this,t),this.keyboard=Object.create(null),this.keypress=Object.create(null),this.mouse=Object.create(null),this.mousePress=Object.create(null),this.mousePos=[],this.mouseMoved=!0,this.events=[]}return Object(l.a)(t,[{key:"addEventListener",value:function(t,e){window.addEventListener(t,e),this.events.push([t,e])}},{key:"start",value:function(){var t=this;this.addEventListener("keydown",(function(e){t.handleKeyEvent(e.key,!0)})),this.addEventListener("keyup",(function(e){t.handleKeyEvent(e.key,!1)})),this.addEventListener("mousedown",(function(e){t.handleMouseEvent(e.button,!0)})),this.addEventListener("mouseup",(function(e){t.handleMouseEvent(e.button,!1)})),this.addEventListener("mousemove",(function(e){t.mousePos=[e.pageX,e.pageY],t.mouseMoved=!0}))}},{key:"end",value:function(){this.events.forEach((function(t){window.removeEventListener(t[0],t[1])})),this.events=[]}},{key:"getMousePosition",value:function(){return this.mousePos}},{key:"mouseToButton",value:function(t){return"left"===t?0:"right"===t?2:parseInt(t)}},{key:"isMouseMove",value:function(){return!!this.mouseMoved&&(this.mouseMoved=!1,!0)}},{key:"isKeyDown",value:function(t){var e=t.toString().toLowerCase();return!!this.keyboard[e]}},{key:"isKeyPressed",value:function(t){var e=t.toString().toLowerCase(),i=this.keypress[e];return i&&(this.keypress[e]=!1),i}},{key:"isMouseDown",value:function(t){return this.mouse[this.mouseToButton(t)]}},{key:"isMousePressed",value:function(t){var e=this.mouseToButton(t),i=this.mousePress[e];return i&&(this.mousePress[e]=!1),i}},{key:"handleKeyEvent",value:function(t,e){var i=t.toString().toLowerCase();e&&this.keyboard[i]||(this.keyboard[i]=e,this.keypress[i]=e)}},{key:"handleMouseEvent",value:function(t,e){this.mouse[t]=e,this.mousePress[t]=e}}]),t}(),k=i(9),b=function(){function t(e){Object(o.a)(this,t),this.game=e,this.particles=[]}return Object(l.a)(t,[{key:"spawnParticles",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=1===i?i:f(.9*i,1.1*i),s=0;s<n;s++){var r=m(0,2*Math.PI),h=m(.1,6)/100,o=Math.cos(r)*m(3,5)/100,l=Math.sin(r)*m(3,5)/100;this.particles.push({x:t+o,y:e+l,size:m(3,6*a)/100,ticks:m(0,1),vx:Math.cos(r)*h,vy:Math.sin(r)*h,alpha:m(0,.1)})}}},{key:"render",value:function(){var t,e=Object(k.a)(this.particles);try{for(e.s();!(t=e.n()).done;){var i=t.value;this.game.ctx.globalAlpha=Math.min(1,Math.max(0,i.alpha)),this.game.render.drawRect(i.x,i.y,Math.max(0,i.size),Math.max(0,i.size),"#fff")}}catch(a){e.e(a)}finally{e.f()}this.game.ctx.globalAlpha=1}},{key:"update",value:function(t){for(var e=[],i=0;i<this.particles.length;i++){var a=this.particles[i];a.x+=t*a.vx,a.y+=t*a.vy,a.ticks+=t,a.ticks>2?(a.size-=t/200,a.alpha-=t/2,(a.size<1e-4||a.alpha<1e-4)&&e.unshift(i)):a.alpha<1&&(a.alpha+=3*t)}for(i=0;i<e.length;i++)this.particles.splice(e[i],1)}}]),t}(),j=function t(e){var i=e.sprite,a=e.frames,n=e.speed,s=e.after,r=e.xOffset,h=e.yOffset,l=e.disableController,c=e.idle,m=e.size;Object(o.a)(this,t),this.sprite=i,this.frames=a,this.speed=n,this.after=s,this.disableController=!!l,this.xOffset=r||0,this.yOffset=h||0,this.idle=!!c,this.size=m};var O=function(t){Object(y.a)(i,t);var e=Object(v.a)(i);function i(t){var a;return Object(o.a)(this,i),(a=e.call(this,t)).x=5,a.y=5,a.w=.55,a.h=.95,a.defaultSize=[a.w,a.h],a.onGround=!1,a.running=!1,a.gravityTick=0,a.ledgeHang=!1,a.facing=0,a.game=t,a.tiles={},a.lastLandY=0,a.animations={idle:new j({sprite:"player_idle",frames:[0,1,2,3,4,5,6],speed:140,after:"idle",idle:!0}),look_up:new j({sprite:"player_look_up",frames:[0,1,2,2,2,2,2,2,2,2,1,0],speed:200,after:"idle",idle:!0}),run:new j({sprite:"player_run",frames:[0,1,2,3,4,5,7],speed:120}),jump:new j({sprite:"player_jump",frames:[0],speed:110,after:"fall"}),fall:new j({sprite:"player_jump",frames:[1,2],speed:250,after:"fall"}),land:new j({sprite:"player_land",frames:[0,1],speed:100,after:"idle",idle:!0}),slide:new j({sprite:"player_slide",frames:[0,1,2],speed:90,after:"slide_transition",disableController:!0,size:[1,.6],yOffset:-.4,xOffset:[.3,.2]}),slide_transition:new j({sprite:"player_slide",frames:[3],speed:100,after:"idle",idle:!0}),roll:new j({sprite:"player_front_flip",frames:[5,6,7,8,9,10,11,12],speed:60,after:"fall",size:[.55,.6],yOffset:-.15}),attack1:new j({sprite:"player_combat_combo_01_attack_01",frames:[0,1,2,3,4,5],speed:100,after:"idle",disableController:!0}),attack2:new j({sprite:"player_combat_combo_01_attack_02",frames:[0,1,2,3,4],speed:100,after:"idle",disableController:!0}),attack3:new j({sprite:"player_combat_combo_01_attack_03",frames:[0,1,2,3],speed:100,after:"idle",disableController:!0}),attack4:new j({sprite:"player_combat_combo_01_attack_04",frames:[0,1,2,3,4,5,6,7,8],speed:100,after:"idle",disableController:!0}),ground_slam:new j({sprite:"player_combat_ground_slam",frames:[0,1,2,3,4,5,6],speed:100,after:"ground_slam_transition",disableController:!0}),ground_slam_transition:new j({sprite:"player_combat_ground_slam",frames:[7,8,9],speed:100,after:"idle",idle:!0}),knockback:new j({sprite:"player_knockback",frames:[0,1,2,4,4,4,4,4,4,4,5],speed:100,after:"idle",disableController:!0}),ledge_climb:new j({sprite:"player_ledge_climb",frames:[0,1,2,3,4,5,6,7],speed:100,after:"ledge_climb",xOffset:[.3,-.3],yOffset:.9}),ledge_hang:new j({sprite:"player_ledge_hang",frames:[0,1,2,3,4,5],speed:100,after:"ledge_hang",xOffset:[-.1,.11]}),wall_jump:new j({sprite:"player_wall_jump",frames:[0,1,2,3,4,5,6,7,8,9,10],speed:100,after:"fall"}),crouch:new j({sprite:"player_crouch",frames:[0,1,2,3,4,5],speed:100,after:"crouch",size:[.55,.6],yOffset:-.4}),crawl:new j({sprite:"player_crawl",frames:[0,1,2,3,4,5,6,7],speed:120,after:"crawl",size:[.55,.6],yOffset:-.4})},a.animation=null,a.animationName="",a.setAnimation("idle"),a.crouch=!1,a}return Object(l.a)(i,[{key:"setCrouch",value:function(t){!this.crouch&&t?(this.setAnimation("crouch"),this.crouch=!0):this.crouch&&!t&&(this.crouch=!1,this.setAnimation("idle"))}},{key:"setAnimation",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.animations[t])throw new Error("Invalid animation: "+t);"crouch"!==t&&"crawl"!==t&&this.setCrouch(!1);var i=this.animation;if(this.animation=this.animations[t],this.animationName=t,this.animationTick=0,this.animation.size)this.w=this.animation.size[0],this.h=this.animation.size[1],this.x+=(this.defaultSize[0]-this.animation.size[0])/2,this.y+=this.defaultSize[1]-this.animation.size[1];else{var a=Object(h.a)(this.defaultSize,2);this.w=a[0],this.h=a[1],e&&i&&i.size&&(this.x-=(this.w-i.size[0])/2,this.y-=this.h-i.size[1])}}},{key:"attack",value:function(){this.game.camera.shake(.15,.8),this.setAnimation("attack1")}},{key:"groundSlam",value:function(){this.setAnimation("ground_slam")}},{key:"jump",value:function(){this.gravityTick=0,this.velocityX=0,this.lastLandY=null,this.game.particleSystem.spawnParticles(this.getCenter()[0],this.getBottom()-.1,4,.3),this.onGround?(this.setAnimation("jump"),this.velocityY=-5):(this.setAnimation("roll"),this.ledgeHang=!1,this.velocityY=-4.85)}},{key:"slide",value:function(){this.velocityX=3*(0==this.facing?-1:1),this.setAnimation("slide")}},{key:"knockback",value:function(){var t=this;this.setAnimation("knockback"),setTimeout((function(){t.velocityX=.1*(0==t.facing?1:-1)}),100)}},{key:"render",value:function(t){this.animationTick+=1e3*t;var e=Math.floor(this.animationTick/this.animation.speed),i=!1;e>this.animation.frames.length-1&&(e>this.animation.frames.length&&(i=!0),e=this.animation.frames.length-1);var a=this.animation.frames[e];this.game.showInfo&&this.game.render.drawRect(this.x,this.y,this.w,this.h,this.onGround?"#444":"#663333");var n=Object(h.a)(this.defaultSize,2),s=n[0],r=n[1];this.game.render.drawSprite({sprite:this.animation.sprite,frame:a,effects:0==this.facing?["flipHorizontally"]:[]},this.x-1.55*s+(Array.isArray(this.animation.xOffset)?this.animation.xOffset[this.facing]:this.animation.xOffset)+0,this.y-1.05*r+this.animation.yOffset,s*r*4.3,s*r*4.3*.875),i&&(this.animation.after?"idle"===this.animationName&&Math.random()>.5?this.setAnimation("look_up"):this.setAnimation(this.animation.after):this.setAnimation(this.animationName)),this.running?(this.animation.idle&&this.setAnimation("run"),"crouch"===this.animationName&&this.setAnimation("crawl")):("run"===this.animationName&&this.setAnimation("idle"),"crawl"===this.animationName&&this.setAnimation("crouch")),this.onGround?"fall"===this.animationName&&this.setAnimation("idle"):(this.animation.idle||!this.ledgeHang&&"ledge_hang"===this.animationName)&&this.setAnimation("fall")}},{key:"update",value:function(t){var e=this.onGround;if(Object(d.a)(Object(g.a)(i.prototype),"update",this).call(this,t),this.onGround||this.ledgeHang?this.gravityTick=0:(this.gravityTick+=t,this.y+=Math.min(this.gravityTick/5,10*t)),this.onGround&&!e){var a=Math.floor(this.y);a!==this.lastLandY&&(this.lastLandY=a,this.game.particleSystem.spawnParticles(this.getCenter()[0],this.getBottom()-.1,5,.3),this.velocityY<0&&(this.velocityY=0),"ground_slam"!==this.animationName&&"knockback"!==this.animationName?this.setAnimation("land",!0):this.game.camera.shake(.1,4))}this.x=Math.max(0,Math.min(this.game.levelWidth-this.w,this.x)),this.y=Math.max(0,Math.min(this.game.levelHeight-this.h,this.y))}}]),i}(w),M=function(){function t(e){Object(o.a)(this,t),this.game=e}return Object(l.a)(t,[{key:"setAlpha",value:function(t){this.game.ctx.globalAlpha=t}},{key:"drawLine",value:function(t,e,i,a,n,s){var r,h;this.game.ctx.strokeStyle=s,this.game.ctx.beginPath(),(r=this.game.ctx).moveTo.apply(r,Object(c.a)(this.game.camera.transformCoordinates(t,e))),(h=this.game.ctx).lineTo.apply(h,Object(c.a)(this.game.camera.transformCoordinates(i,a))),this.game.ctx.lineWidth=this.game.camera.transformX(n),this.game.ctx.stroke(),this.game.ctx.closePath()}},{key:"drawRect",value:function(t,e,i,a,n){var s;this.game.ctx.fillStyle=n,(s=this.game.ctx).fillRect.apply(s,Object(c.a)(this.game.camera.transformRect(t,e,i,a)))}},{key:"drawCircle",value:function(t,e,i,a){var n;this.game.ctx.fillStyle=a,this.game.ctx.beginPath(),(n=this.game.ctx).arc.apply(n,Object(c.a)(this.game.camera.transformCoordinates(t,e)).concat([this.game.camera.transformX(i),2*Math.PI,0])),this.game.ctx.fill(),this.game.ctx.closePath()}},{key:"drawSprite",value:function(t,e,i,a,n){var s=this.game.ssm.getSpriteFromInfoObject(t);if(s){this.drawScalingSprite(t,e,i,a,n);var r=s.h/s.w,h=n/a;if(r.toFixed(2)!==h.toFixed(2))throw new Error("Invalid aspect ratio while drawing "+JSON.stringify(t)+", expected: "+r+", received: "+h)}}},{key:"drawScalingSprite",value:function(t,e,i,a,n){var s=this.game.ssm.getSpriteFromInfoObject(t);s&&this.drawImage(s.spriteSheet.image,e,i,a,n,s.x,s.y,s.w,s.h)}},{key:"drawImage",value:function(t,e,i,a,n,s,r,h,o){var l;(l=this.game.ctx).drawImage.apply(l,[t,s,r,h,o].concat(Object(c.a)(this.game.camera.transformRect(e,i,a,n).map(Math.round))))}},{key:"drawImageWithRotation",value:function(t,e,i,a,n,s,r,o,l,c){var m=this.game.camera.transformRect(e,i,a,n),f=Object(h.a)(m,4),u=f[0],p=f[1],d=f[2],g=f[3];u+=d/2,p+=g/2;var y=this.game.ctx,v=c*(Math.PI/180);y.translate(u,p),y.rotate(v),y.drawImage(t,s,r,o,l,-d/2,-g/2,d,g),y.rotate(-v),y.translate(-u,-p)}},{key:"drawText",value:function(t,e,i,a,n){var s;this.game.ctx.fillStyle=n,this.game.ctx.font=a+"px",(s=this.game.ctx).fillText.apply(s,[t].concat(Object(c.a)(this.game.camera.transformCoordinates(e,i))))}},{key:"drawScalingText",value:function(t,e,i,a,n,s){var r;this.game.ctx.fillStyle=s,this.game.ctx.font=n+"px",(r=this.game.ctx).fillText.apply(r,[t].concat(Object(c.a)(this.game.camera.transformCoordinates(e,i)),[this.game.camera.transformX(a)]))}}]),t}(),S=i(5),C=i.n(S),T=i(10),P=function(){function t(){Object(o.a)(this,t),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return Object(l.a)(t,[{key:"applyEffectsToSpriteSheet",value:function(){var t=Object(T.a)(C.a.mark((function t(e,i){var a,n,s,r,h,o,l,c,m,f,u,p,d,g,y;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.length){t.next=2;break}return t.abrupt("return",e);case 2:for(r in a=new Map,s={},e.sprites)h=e.sprites[r],o=h.spriteSheet.image,l=new A(h,h.spriteSheet),s[r]=l,n||(n=o),a.has(o)?a.get(o).push(l):a.set(o,[l]);return t.t0=E,t.next=8,this.applyEffectsToImage(n,i);case 8:t.t1=t.sent,t.t2={type:"manual",sprites:{}},t.t3=e.ssm,(c=new t.t0(t.t1,t.t2,t.t3,!1)).sprites=s,m=Object(k.a)(a.keys()),t.prev=14,m.s();case 16:if((f=m.n()).done){t.next=28;break}return o=f.value,u=a.get(o),t.next=21,this.applyEffectsToImage(o,i);case 21:p=t.sent,(d=new E(p,{type:"manual",sprites:{}},e.ssm,!1)).sprites=u,g=Object(k.a)(u);try{for(g.s();!(y=g.n()).done;)(h=y.value).spriteSheet=d}catch(v){g.e(v)}finally{g.f()}case 26:t.next=16;break;case 28:t.next=33;break;case 30:t.prev=30,t.t4=t.catch(14),m.e(t.t4);case 33:return t.prev=33,m.f(),t.finish(33);case 36:return t.abrupt("return",c);case 37:case"end":return t.stop()}}),t,this,[[14,30,33,36]])})));return function(e,i){return t.apply(this,arguments)}}()},{key:"applyEffectsToImage",value:function(){var t=Object(T.a)(C.a.mark((function t(e,i){var a,n,s,r;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.length){t.next=2;break}return t.abrupt("return",e);case 2:a=e,n=Object(k.a)(i),t.prev=4,n.s();case 6:if((s=n.n()).done){t.next=13;break}return r=s.value,t.next=10,this.applyEffectToImage(a,r);case 10:a=t.sent;case 11:t.next=6;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(4),n.e(t.t0);case 18:return t.prev=18,n.f(),t.finish(18);case 21:return t.abrupt("return",a);case 22:case"end":return t.stop()}}),t,this,[[4,15,18,21]])})));return function(e,i){return t.apply(this,arguments)}}()},{key:"applyEffectToImage",value:function(){var t=Object(T.a)(C.a.mark((function t(e,i){var a=this;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var s="string"===typeof i?i:i.name;switch(a.canvas.width=e.width,a.canvas.height=e.height,a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),s){case"flipHorizontally":a.flipHorizontally(e);break;case"teamColor":a.teamColor(e,i.payload);break;default:throw new Error("Invalid effect name "+s)}var r=new Image,h=a.canvas.toDataURL("image/png");r.src=h,r.onload=function(){r.loaded=!0,t(r)}})));case 1:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}()},{key:"teamColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ff2222",i=this.ctx,a=this.canvas;Array.isArray(e)&&(e="rgb("+e.join(",")+")"),this.canvas.width=t.width,this.canvas.height=t.height,i.drawImage(t,0,0),i.globalCompositeOperation="darken",i.fillStyle=e,i.fillRect(0,0,a.width,a.height),i.globalAlpha=1,i.globalCompositeOperation="destination-in",i.drawImage(t,0,0)}},{key:"flipHorizontally",value:function(t){var e=this;this.canvas.width=t.width,this.canvas.height=t.height;var i=function(t,i,a){e.ctx.translate(i+t.width,a),e.ctx.scale(-1,1),e.ctx.drawImage(t,0,0),e.ctx.setTransform(1,0,0,1,0,0)};i(t,0,0)}}]),t}(),I="/react-platformer/build/sprites/",E=function(){function t(e,i,a){var n=this,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(Object(o.a)(this,t),!a||!(a instanceof z))throw new Error("Invalid spriteSheetManager");this.sprites={},this.ssm=a,this.effectsCache={},this.creating={},this.name="",this.image=e instanceof Image?e:new Image,"string"===typeof e&&(this.image.src=I+e),this.image.addEventListener("error",(function(t){console.log("Error loading "+n.image.src,t)})),this.image.addEventListener("load",(function(){if(n.image.loaded=!0,s&&n.ssm.incrementLoaded(),"auto"===i.type){if(!i.width||!i.height)throw new Error("Invalid width/height on info "+JSON.stringify(i));var a=i.width,r=i.height,h=i.border||0,o=n.image.width-2*h,l=n.image.height-2*h;if(a>o)throw new Error(e+" invalid sprite width "+a+" when image is "+o+"px wide");if(r>l)throw new Error(e+" invalid sprite height "+a+" when image is "+l+"px tall");for(var c=0,m=0,f=0;n.sprites[f]=new A({x:c,y:m,w:a,h:r},n),f++,(c+=a)>=o&&(c=h,m+=r),!(m>=l););}else if("manual"===i.type){if(!i.sprites)throw new Error("Invalid sprites on info "+JSON.stringify(i));var u=i.sprites;for(var p in u)n.sprites[p]=new A(u[p],n)}else if("increment_file_name"===i.type){var d=e.split("1.png")[0];if(!e.includes("1.png"))throw new Error("Invalid path");n.sprites[0]=new A({x:0,y:0,w:n.image.width,h:n.image.height},n);for(f=2;f<=i.max;f++)!function(e){var i=d+e+".png",a=new A({x:0,y:0,w:n.image.width,h:n.image.height},new t(i,{type:"single"},n.ssm));a.indirect=!0,n.sprites[e-1]=a}(f)}else"single"===i.type&&(n.sprites={0:new A({x:0,y:0,w:n.image.width,h:n.image.height},n)})}))}return Object(l.a)(t,[{key:"getSprite",value:function(t){var e=this.sprites[t];if(!e)throw new Error("Invalid sprite: "+t+" ("+this.name+") ["+Object.keys(this.sprites).join(",")+"]");return e}},{key:"getEffects",value:function(e){var i=this;if(!e.length)return this;var a=JSON.stringify(e);return this.effectsCache[a]?this.effectsCache[a]:(this.creating[a]||(this.creating[a]=!0,Object(T.a)(C.a.mark((function n(){var s,r;return C.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=new P,n.next=3,s.applyEffectsToSpriteSheet(i,e);case 3:if((r=n.sent)instanceof t){n.next=6;break}throw new Error("Expected SpriteSheet");case 6:i.effectsCache[a]=r,i.creating[a]=!1;case 8:case"end":return n.stop()}}),n)})))()),this)}}]),t}(),A=function t(e,i){if(Object(o.a)(this,t),!(i instanceof E))throw new Error("Invalid sprite sheet");this.x=e.x||0,this.y=e.y||0,this.w=e.w||0,this.h=e.h||0,this.spriteSheet=i},z=function(){function t(){Object(o.a)(this,t),this.spriteSheets={},this.assetsLoaded=0,this.assetsTotal=0,this.hasLoaded=!1,this.onLoaded=function(){}}return Object(l.a)(t,[{key:"incrementLoaded",value:function(){var t=this;this.assetsLoaded++,console.log(this.assetsLoaded,this.assetsTotal),setTimeout((function(){t.assetsLoaded===t.assetsTotal&&(t.hasLoaded||(t.hasLoaded=!0,t.onLoaded()))}),90)}},{key:"addSpriteSheet",value:function(t,e,i){var a=new E(e,i,this);return a.name=t,"increment_file_name"===i.type?this.assetsTotal+=i.max:this.assetsTotal+=1,this.spriteSheets[t]=a,a}},{key:"getSpriteSheet",value:function(t){if(!this.spriteSheets[t])throw new Error("Invalid sprite sheet: "+t);return this.spriteSheets[t]}},{key:"getSprite",value:function(t){var e=t.split(":")[0],i=t.split(":")[1];return this.getSpriteSheet(e).getSprite(i)}},{key:"getSpriteFromInfoObject",value:function(t){var e=t.sprite,i=t.frame,a=t.effects||[],n=this.getSpriteSheet(e).getEffects(a);if(n)return n.getSprite(i);throw new Error("No sprite sheet")}}]),t}(),L=i(26),X=function(){function t(e,i,a){Object(o.a)(this,t),this.canvas=e,this.ctx=i,this.ssm=a,this.render=new M(this),this.camera=new u(this),this.inputManager=new x,this.particleSystem=new b(this),this.player=new O(this),this.controller=new p(this),this.entities={};var n=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,5,5,0,0,0,0,0,0,0,0,0,0],[0,5,0,5,0,0,0,0,5,5,5,5,0,0,0],[0,5,0,5,0,0,0,0,0,0,0,5,0,0,0],[0,5,0,5,0,5,5,0,0,0,0,5,0,0,0],[0,5,0,0,0,5,0,0,0,0,0,5,0,0,0],[0,5,5,5,5,5,0,0,5,5,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,5,5,0,0],[0,0,0,5,5,5,5,0,0,0,0,0,5,5,0],[0,0,0,0,5,5,0,0,0,0,0,0,0,5,5],[0,0,0,0,0,5,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,5,0,0,0,0,5,5,5,5,0,0,0,0,0],[5,5,5,0,0,0,0,0,0,5,5,0,0,0,0],[0,5,0,0,0,0,0,0,0,0,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,0,0,5,5,0,0,0,5,5,5,5],[5,5,5,0,0,0,0,0,0,0,0,0,5,5,5],[5,5,5,5,5,0,0,0,0,0,0,0,5,5,5],[5,5,5,5,5,0,0,0,0,0,0,5,5,5,5],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]];if(this.showInfo=!1,this.map=n.flat(1),this.levelWidth=n[0].length,this.levelHeight=n.length,this.camera.endY=this.levelHeight-7,this.camera.startY=this.levelHeight-15,this.camera.maxY=this.levelHeight,this.camera.minX=0,this.player.y=this.levelHeight-12,this.spawnTick=0,this.fpsTick=0,this.fps=0,this.map.length!==this.levelWidth*this.levelHeight)throw new Error("Invalid map length: "+this.map.length);this.collisionMap=this.createCollisionMap()}return Object(l.a)(t,[{key:"end",value:function(){this.inputManager.end()}},{key:"spawnEntity",value:function(){var t=Object(L.a)(),e=new _(this);this.entities[t]=e;var i=Math.random()>.5?-1:1;this.camera.startX<=0&&(i=1),e.x=-1===i?this.camera.endX+2:this.camera.startX-2,e.direction=i,e.y=this.player.y+f(-2,2)}},{key:"createCollisionMap",value:function(){for(var t=[],e=0;e<this.map.length;e++){var i=0;if(this.map[e]){var a=this.convertIndexToCoordinates(e),n=Object(h.a)(a,2),s=n[0],r=n[1],o=this.map[this.convertCoordinatesToIndex(s,r-1)],l=this.map[this.convertCoordinatesToIndex(s,r+1)],c=this.map[this.convertCoordinatesToIndex(s-1,r)],m=this.map[this.convertCoordinatesToIndex(s+1,r)];0!==s&&(i|=c?0:1),s!==this.levelWidth-1&&(i|=m?0:2),0!==r&&(i|=o?0:4),r!==this.levelHeight-1&&(i|=l?0:8)}t.push(i)}return t}},{key:"getViewport",value:function(){return[this.canvas.width,this.canvas.height]}},{key:"start",value:function(){this.inputManager.start(),this.particleSystem.particles=[],this.camera.followingObject=this.player}},{key:"convertIndexToCoordinates",value:function(t){return[t%this.levelWidth,Math.floor(t/this.levelWidth)]}},{key:"convertCoordinatesToIndex",value:function(t,e){return e*this.levelWidth+t}},{key:"renderGame",value:function(t){for(var e in this.ctx.fillStyle="#fff",this.ctx.font="20px Readex Pro",this.ctx.fillText(this.fps+"",5,20),this.ctx.font="14px Readex Pro",this.player.render(t),this.entities){this.entities[e].render(t)}for(var i=0;i<this.map.length;i++){var a=this.collisionMap[i],n=this.convertIndexToCoordinates(i),s=Object(h.a)(n,2),r=s[0],o=s[1];if(r+1>this.camera.startX&&o+1>this.camera.startY&&r<=this.camera.endX&&o<=this.camera.endY){var l="#fff",c=.025;1&a&&(this.render.drawRect(r,o,c,1,l),this.render.drawText("1",r+.1,o+.53,14)),2&a&&(this.render.drawRect(r+.975,o,c,1,l),this.render.drawText("2",r+.82,o+.53,14)),4&a&&(this.render.drawRect(r,o,1,c,l),this.render.drawText("4",r+.49,o+.2,14)),8&a&&(this.render.drawRect(r,o+.975,1,c,l),this.render.drawText("8",r+.49,o+.92,14))}}var m=Object.keys(this.player.tiles);for(i=0;i<m.length;i++){var f=m[i],u=(a=this.player.tiles[f],this.convertIndexToCoordinates(f)),p=Object(h.a)(u,2);r=p[0],o=p[1];1&a&&this.render.drawRect(r,o,.05,1,"#fff"),2&a&&this.render.drawRect(r+.95,o,.05,1,"#fff"),4&a&&this.render.drawRect(r,o,1,.05,"#fff"),8&a&&this.render.drawRect(r,o+.95,1,.05,"#fff")}this.particleSystem.render()}},{key:"updateGame",value:function(t){this.fpsTick+=t,this.fpsTick>.5&&(this.fpsTick=0,this.fps=Math.floor(1/t)),this.spawnTick+=t,this.spawnTick>2&&(this.spawnTick=0,this.spawnEntity()),this.controller.update(t);var e=[];for(var i in this.entities){var a=this.entities[i];a.update(t),a.delete&&e.push(i)}for(var n=0,s=e;n<s.length;n++){i=s[n];delete this.entities[i]}this.player.update(t),this.particleSystem.update(t),this.camera.update(t)}}]),t}(),Y={player_idle:{type:"increment_file_name",imgPath:"pixel_platformer_player/idle/1.png",max:7},player_run:{type:"increment_file_name",imgPath:"pixel_platformer_player/run/1.png",max:8},player_jump:{type:"increment_file_name",imgPath:"pixel_platformer_player/jump/1.png",max:3},player_land:{type:"increment_file_name",imgPath:"pixel_platformer_player/land/1.png",max:2},player_slide:{type:"increment_file_name",imgPath:"pixel_platformer_player/slide/1.png",max:4},player_roll:{type:"increment_file_name",imgPath:"pixel_platformer_player/roll/1.png",max:10},player_combat_combo_01_attack_01:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_01/1.png",max:6},player_combat_combo_01_attack_02:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_02/1.png",max:5},player_combat_combo_01_attack_03:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_03/1.png",max:4},player_combat_combo_01_attack_04:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_04/1.png",max:9},player_combat_ground_slam:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_ground_slam/1.png",max:10},player_look_up:{type:"increment_file_name",imgPath:"pixel_platformer_player/look_up/1.png",max:3},player_knockback:{type:"increment_file_name",imgPath:"pixel_platformer_player/knockback/1.png",max:6},player_ledge_climb:{type:"increment_file_name",imgPath:"pixel_platformer_player/ledge_climb/1.png",max:8},player_ledge_hang:{type:"increment_file_name",imgPath:"pixel_platformer_player/ledge_hang/1.png",max:6},player_wall_jump:{type:"increment_file_name",imgPath:"pixel_platformer_player/wall_jump/1.png",max:11},player_wall_slide:{type:"increment_file_name",imgPath:"pixel_platformer_player/wall_slide/1.png",max:6},player_crouch:{type:"increment_file_name",imgPath:"pixel_platformer_player/crouch/1.png",max:6},player_crawl:{type:"increment_file_name",imgPath:"pixel_platformer_player/crawl/1.png",max:8},player_front_flip:{type:"increment_file_name",imgPath:"pixel_platformer_player/front_flip/1.png",max:14}},R=i(2);var H=function(){var t=Object(a.useRef)(),e=Object(a.useState)(!1),i=Object(h.a)(e,2),n=i[0],s=i[1],r=Object(a.useRef)();return Object(a.useEffect)((function(){var e=new z;Object.keys(Y).forEach((function(t){var i=Y[t];e.addSpriteSheet(t,i.imgPath,i)}));var i=t.current;if(i){var a=i.getContext("2d"),n=performance.now(),s=new X(i,a,e);r.current=s,window.game=s;var h=function(){i.width=window.innerWidth,i.height=window.innerHeight,i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",s.camera.updateAspectRatio()};h();var o=!0;return s.active=!0,e.onLoaded=function(){Object.keys(e.spriteSheets).forEach((function(t){t.includes("player_")&&e.spriteSheets[t].getEffects(["flipHorizontally"])})),l(),setTimeout((function(){s.start()}),100)},window.addEventListener("resize",h),function(){cancelAnimationFrame(l),window.removeEventListener("resize",h),o=!1,s.end()}}function l(){var t=performance.now(),e=(t-n)/1e3;n=t,e>.25&&(e=.25),a.fillStyle="#000",a.fillRect(0,0,i.width,i.height),s.active&&s.updateGame(e),s.renderGame(e),o&&requestAnimationFrame(l)}}),[]),Object(R.jsxs)("div",{className:n?"":"hide-cursor",children:[Object(R.jsxs)("div",{className:"main-menu"+(n?" main-menu-show":""),children:[Object(R.jsx)("h1",{children:"Platformer"}),Object(R.jsx)("p",{children:"by: MichaelXF"}),Object(R.jsx)("button",{className:"main-btn",onClick:function(){s(!1)},children:"Play"})]}),Object(R.jsx)("canvas",{ref:t}),Object(R.jsxs)("div",{className:"controls",children:[Object(R.jsx)("kbd",{children:"W"}),Object(R.jsx)("kbd",{children:"A"}),Object(R.jsx)("kbd",{children:"S"}),Object(R.jsx)("kbd",{children:"D"})]})]})},N=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,27)).then((function(e){var i=e.getCLS,a=e.getFID,n=e.getFCP,s=e.getLCP,r=e.getTTFB;i(t),a(t),n(t),s(t),r(t)}))};r.a.render(Object(R.jsx)(n.a.StrictMode,{children:Object(R.jsx)(H,{})}),document.getElementById("root")),N()}},[[24,1,2]]]);
//# sourceMappingURL=main.21a764cb.chunk.js.map